<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•˜í”„ì›¨ë“œ ê²°í˜¼ì¤€ë¹„ ê²¬ì ì„œ</title>
    <style>
        /* --- CSS ìŠ¤íƒ€ì¼ --- */
        :root {
            --primary-color: #ff7a8a;
            --bg-color: #f9f9f9;
            --text-color: #333;
            --border-color: #ddd;
        }
        
        /* ëª¨ë“  ìš”ì†Œì˜ ë„ˆë¹„ ê³„ì‚°ì„ í…Œë‘ë¦¬ í¬í•¨ìœ¼ë¡œ í†µì¼ (ë²„íŠ¼ ê¸¸ì´ ë§ì¶¤ í•µì‹¬) */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
            min-height: 100vh;
        }

        h1, h2, h3 {
            text-align: center;
            color: #444;
        }

        h1 { margin-bottom: 30px; border-bottom: 2px solid var(--primary-color); padding-bottom: 15px; }

        /* ì…€ë ‰ì…˜ ì˜ì—­ */
        .category-section {
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
        }

        .category-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .selection-display {
            background: #f1f1f1;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
            color: #555;
            cursor: pointer;
        }
        .selection-display:hover { background: #e1e1e1; }

        .option-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-top: 10px;
            display: none; 
        }

        /* ë²¤ë” ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬/íŒì—… ìŠ¤íƒ€ì¼ */
        .vendor-list-area {
            display: none;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            border-top: 1px solid #eee;
        }
        .vendor-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .vendor-item:hover { background-color: #fff0f2; }

        /* ì…ë ¥ ë° ë²„íŠ¼ */
        .input-group {
            margin: 20px 0;
            text-align: center;
        }
        input[type="text"] {
            padding: 10px;
            width: 60%;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ í†µí•© */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 10px;
            text-align: center;
            text-decoration: none; /* ë§í¬ ë°‘ì¤„ ì œê±° */
        }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
        
        /* ì¹´ì¹´ì˜¤ ë²„íŠ¼ ì „ìš© ìƒ‰ìƒ */
        .btn-kakao {
            background-color: #FAE100;
            color: #3C1E1E;
            font-weight: bold;
        }

        /* ê²°ê³¼ í™”ë©´ */
        #result-view { display: none; }
        .quote-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .quote-table th, .quote-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .quote-table th { background-color: #f8f8f8; width: 25%; }
        
        .total-price-area {
            text-align: center;
            font-size: 1.5em;
            color: #d9534f;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            background: #fff5f5;
            border-radius: 10px;
        }

        .notice-box {
            font-size: 0.9em;
            color: #666;
            background: #f1f1f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        /* ê´€ë¦¬ì ëª¨ë“œ ì•„ì´ì½˜ */
        #admin-icon {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 20px;
            opacity: 0.3;
            cursor: pointer;
        }
        
        /* ê´€ë¦¬ì ëª¨ë‹¬ */
        #admin-modal {
            display: none;
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            overflow-y: auto;
        }
        .admin-content {
            background: white;
            margin: 50px auto;
            padding: 20px;
            width: 95%;
            max-width: 650px;
            border-radius: 8px;
        }
        .admin-form-group {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            background: #fdfdfd;
        }
        .admin-form-group input, .admin-form-group textarea {
            width: 95%;
            margin-bottom: 5px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .close-btn { float: right; cursor: pointer; font-size: 1.5em; }
        
        .admin-btn-group {
            display: flex;
            gap: 10px;
        }
        .btn-edit {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 3px 8px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 0.8em;
        }
        .btn-del {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 3px 8px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 0.8em;
        }
        
        /* ìƒí’ˆ ë™ì  ì¶”ê°€ UI */
        .product-row {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
            align-items: center;
        }
        .product-row input[type="text"] { flex: 2; }
        .product-row input[type="number"] { flex: 1; }
        .btn-remove-prod {
            background: #ff4444; color: white; border: none; 
            width: 25px; height: 25px; border-radius: 50%; cursor: pointer;
        }
        .btn-add-prod {
            background: #4CAF50; color: white; border: none;
            padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.9em;
            margin-bottom: 10px;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>í•˜í”„ì›¨ë“œ ê²°í˜¼ì¤€ë¹„ ê²¬ì ì„œ</h1>

    <!-- ê²¬ì  ì„ íƒ í™”ë©´ -->
    <div id="selection-view">
        
        <!-- 1. ìŠ¤íŠœë””ì˜¤ -->
        <div class="category-section" id="sec-studio">
            <div class="category-title">ìŠ¤íŠœë””ì˜¤</div>
            <div class="selection-display" onclick="toggleVendorList('studio')">ì—…ì²´ ì„ íƒí•˜ê¸° (í´ë¦­)</div>
            <div class="vendor-list-area" id="list-studio"></div>
            <select class="option-select" id="opt-studio">
                <option value="">ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>

        <!-- 2. ë“œë ˆìŠ¤ -->
        <div class="category-section" id="sec-dress">
            <div class="category-title">ë“œë ˆìŠ¤</div>
            <div class="selection-display" onclick="toggleVendorList('dress')">ì—…ì²´ ì„ íƒí•˜ê¸° (í´ë¦­)</div>
            <div class="vendor-list-area" id="list-dress"></div>
            <select class="option-select" id="opt-dress">
                <option value="">ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>

        <!-- 3. ë©”ì´í¬ì—… -->
        <div class="category-section" id="sec-makeup">
            <div class="category-title">ë©”ì´í¬ì—…</div>
            <div class="selection-display" onclick="toggleVendorList('makeup')">ì—…ì²´ ì„ íƒí•˜ê¸° (í´ë¦­)</div>
            <div class="vendor-list-area" id="list-makeup"></div>
            <select class="option-select" id="opt-makeup">
                <option value="">ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>

        <!-- 4. ë³¸ì‹ì‚¬ì§„ -->
        <div class="category-section" id="sec-snap">
            <div class="category-title">ë³¸ì‹ì‚¬ì§„</div>
            <div class="selection-display" onclick="toggleVendorList('snap')">ì—…ì²´ ì„ íƒí•˜ê¸° (í´ë¦­)</div>
            <div class="vendor-list-area" id="list-snap"></div>
            <select class="option-select" id="opt-snap">
                <option value="">ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>

        <div class="input-group">
            <input type="text" id="naver-id" placeholder="ë„¤ì´ë²„ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
        </div>

        <button class="btn" onclick="calculateQuote()">ê²¬ì  í™•ì¸í•˜ê¸°</button>
    </div>

    <!-- ê²¬ì  ê²°ê³¼ í™”ë©´ -->
    <div id="result-view">
        <h2>ê²¬ì  ê²°ê³¼</h2>
        <p style="text-align:right; font-size:0.9em; color:#888;">ë„¤ì´ë²„ID: <span id="res-naver-id"></span></p>
        
        <table class="quote-table">
            <tbody id="quote-result-body">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì±„ì›Œì§ -->
            </tbody>
        </table>

        <div class="total-price-area">
            í•©ê³„: <span id="total-amount">0</span>ì›
        </div>

        <div class="notice-box">
            <strong>ì•ˆë‚´ ë“œë¦½ë‹ˆë‹¤.</strong><br><br>
            ìœ„ ê²¬ì  ë¶ˆí¬í•¨ ì‚¬í•­: ë“œë ˆìŠ¤íˆ¬ì–´ ì§„í–‰ í¬ë§ ì‹œ í”¼íŒ…ë¹„(ì—…ì²´ë‹¹ 5.5ë§Œ~22ë§Œì›. ì—…ì²´ë³„ ìƒì´), í—¬í¼ë¹„(25ë§Œì›~. ì—…ì²´,ì‹œê°„,ì¥ì†Œ,ì˜ìƒìˆ˜ë³„ ìƒì´), ë©”ì´í¬ì—… ìŠ¤íƒ€íŠ¸ ì‹œê°„ëŒ€ë³„ ì¶”ê°€ë¹„ìš©(5.5ë§Œì›~), ë¶€ì¼€(14ë§Œì›~)<br>
            ì„œìš¸ ì™¸ ì§€ì—­ ì´¬ì˜ ë° ë³¸ì‹ì§„í–‰ ì‹œ í—¬í¼ ë° ë³¸ì‹ì‚¬ì§„ ì¶œì¥ë¹„ê°€ ì¶”ê°€ë¡œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì—…ì²´, ì§€ì—­ë³„ ìƒì´)<br>
            ì—…ì²´ì˜ í”„ë¡œëª¨ì…˜, ê°€ê²©ì •ì±… ë³€ë™ì— ë”°ë¼ ê¸ˆì•¡ì€ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>

        <!-- ë²„íŠ¼ ì˜ì—­ -->
        <a href="https://center-pf.kakao.com/_lktxbn/chats" target="_blank" class="btn btn-kakao">
            ì¹´ì¹´ì˜¤í†¡ ìƒë‹´ ì—°ê²°
        </a>
        <button class="btn" style="background:#ccc;" onclick="location.reload()">
            ë‹¤ì‹œ ê²¬ì ë‚´ê¸°
        </button>
    </div>
</div>

<!-- ê´€ë¦¬ì ëª¨ë“œ ì§„ì… ì•„ì´ì½˜ -->
<div id="admin-icon" onclick="enterAdminMode()">ğŸ”’</div>

<!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
<div id="admin-modal">
    <div class="admin-content">
        <span class="close-btn" onclick="closeAdminMode()">&times;</span>
        <h2>ê´€ë¦¬ì ëª¨ë“œ</h2>
        <p>ì—…ì²´ ê´€ë¦¬ ë° ìƒí’ˆ ì„¤ì •</p>
        
        <div style="margin-bottom: 15px;">
            <label>ì¹´í…Œê³ ë¦¬ ì„ íƒ:</label>
            <select id="admin-category-select" onchange="resetAdminForm()">
                <option value="studio">ìŠ¤íŠœë””ì˜¤</option>
                <option value="dress">ë“œë ˆìŠ¤</option>
                <option value="makeup">ë©”ì´í¬ì—…</option>
                <option value="snap">ë³¸ì‹ì‚¬ì§„</option>
            </select>
        </div>

        <!-- ì…ë ¥/ìˆ˜ì • í¼ -->
        <div class="admin-form-group">
            <h4>ì •ë³´ ì…ë ¥</h4>
            <input type="text" id="new-vendor-name" placeholder="ì—…ì²´ ì´ë¦„ (ì˜ˆ: XX ìŠ¤íŠœë””ì˜¤)">
            <textarea id="new-vendor-desc" placeholder="êµ¬ì„± ì„¤ëª… (ì˜ˆ: 20P ì•¨ë²”, ì›ë³¸í¬í•¨ ë“±)" rows="2"></textarea>
            
            <hr style="margin: 15px 0; border:0; border-top:1px dashed #ccc;">
            
            <h5>ìƒí’ˆ ë° ê°€ê²© ì„¤ì •</h5>
            <div id="product-list-container">
                <!-- ë™ì  ìƒí’ˆ row -->
            </div>
            <button type="button" class="btn-add-prod" onclick="addProductRow()">+ ìƒí’ˆ ì¶”ê°€</button>
        </div>

        <div class="admin-btn-group">
            <button class="btn" id="btn-save-vendor" onclick="saveVendor()">ì—…ì²´ ì €ì¥/ì¶”ê°€</button>
            <button class="btn" id="btn-cancel-edit" onclick="cancelEdit()" style="background:#999; display:none;">ìˆ˜ì • ì·¨ì†Œ</button>
        </div>

        <hr>
        <h3>ë“±ë¡ëœ ì—…ì²´ ëª©ë¡</h3>
        <ul id="admin-vendor-list" style="padding-left:20px;"></ul>
    </div>
</div>

<script>
/* --- JavaScript ë¡œì§ --- */

// 1. ê¸°ë³¸ ì„¤ì •
const categories = ['studio', 'dress', 'makeup', 'snap'];
const categoryNames = {
    studio: 'ìŠ¤íŠœë””ì˜¤',
    dress: 'ë“œë ˆìŠ¤',
    makeup: 'ë©”ì´í¬ì—…',
    snap: 'ë³¸ì‹ì‚¬ì§„'
};

// ë°ì´í„° êµ¬ì¡° (v2)
let vendorData = JSON.parse(localStorage.getItem('halfwed_data_v2')) || {
    studio: [
        {
            id: 1, name: "ìƒ˜í”Œ ìŠ¤íŠœë””ì˜¤", desc: "ê¹”ë”í•œ ì¸ë¬¼ ì¤‘ì‹¬", 
            products: [
                {name: "ë‹¨í’ˆ", price: 2000000},
                {name: "í† íƒˆ", price: 1500000}
            ]
        }
    ],
    dress: [
        {
            id: 2, name: "ìƒ˜í”Œ ë“œë ˆìŠ¤", desc: "í™”ë ¤í•œ ë¹„ì¦ˆ ë§›ì§‘",
            products: [
                {name: "ì´¬ì˜+ë³¸ì‹", price: 1000000},
                {name: "ì´¬ì˜ë§Œ", price: 500000},
                {name: "ë³¸ì‹ë§Œ", price: 800000}
            ]
        }
    ],
    makeup: [
        {
            id: 3, name: "ìƒ˜í”Œ ë©”ì´í¬ì—…", desc: "ê³¼ì¦™ ë©”ì´í¬ì—… ì „ë¬¸",
            products: [
                {name: "ì´¬ì˜+ë³¸ì‹(ì‹¤ì¥2íšŒ)", price: 1000000},
                {name: "ë³¸ì‹(ì‹¤ì¥1íšŒ)", price: 500000}
            ]
        }
    ],
    snap: [
        {
            id: 4, name: "ìƒ˜í”Œ ìŠ¤ëƒ…", desc: "ë”°ëœ»í•œ ìƒ‰ê°",
            products: [
                {name: "ë³¸ì‹ìŠ¤ëƒ…", price: 1000000},
                {name: "ë³¸ì‹ì‚¬ì§„", price: 1800000}
            ]
        }
    ]
};

let currentEditIndex = -1;
let userSelections = { studio: null, dress: null, makeup: null, snap: null };

window.onload = function() {
    if(!localStorage.getItem('halfwed_data_v2')) {
        localStorage.setItem('halfwed_data_v2', JSON.stringify(vendorData));
    }
};

// 2. ì‚¬ìš©ì í™”ë©´ ê¸°ëŠ¥

function toggleVendorList(cat) {
    const listArea = document.getElementById(`list-${cat}`);
    const isVisible = listArea.style.display === 'block';
    document.querySelectorAll('.vendor-list-area').forEach(el => el.style.display = 'none');
    if (!isVisible) {
        renderVendorList(cat);
        listArea.style.display = 'block';
    }
}

function renderVendorList(cat) {
    const listArea = document.getElementById(`list-${cat}`);
    listArea.innerHTML = '';
    const vendors = vendorData[cat];
    if(vendors.length === 0) {
        listArea.innerHTML = '<div style="padding:10px;">ë“±ë¡ëœ ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }
    vendors.forEach((v, idx) => {
        const div = document.createElement('div');
        div.className = 'vendor-item';
        div.innerText = v.name;
        div.onclick = () => selectVendor(cat, idx, v.name);
        listArea.appendChild(div);
    });
}

function selectVendor(cat, idx, name) {
    const display = document.querySelector(`#sec-${cat} .selection-display`);
    display.innerText = `[ì„ íƒë¨] ${name}`;
    display.style.background = '#ffeff1';
    document.getElementById(`list-${cat}`).style.display = 'none';

    const selectEl = document.getElementById(`opt-${cat}`);
    selectEl.style.display = 'block';
    selectEl.innerHTML = '<option value="">ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>';
    
    const vendor = vendorData[cat][idx];
    if(vendor && vendor.products) {
        vendor.products.forEach((prod, pIdx) => {
            const option = document.createElement('option');
            option.value = pIdx;
            option.innerText = prod.name;
            selectEl.appendChild(option);
        });
    }

    userSelections[cat] = { vendorIndex: idx, optionIndex: -1, name: name };
    selectEl.onchange = (e) => {
        userSelections[cat].optionIndex = parseInt(e.target.value);
    };
}

function calculateQuote() {
    const naverId = document.getElementById('naver-id').value.trim();
    if (!naverId) {
        alert("ë„¤ì´ë²„ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    let totalCost = 0;
    let selectedCount = 0;
    let html = '';

    for (const cat of categories) {
        const sel = userSelections[cat];
        if (sel && sel.optionIndex !== -1 && !isNaN(sel.optionIndex)) {
            
            const vendor = vendorData[cat][sel.vendorIndex];
            if(!vendor) continue;
            
            const product = vendor.products[sel.optionIndex];
            
            selectedCount++;
            totalCost += parseInt(product.price);

            html += `
                <tr>
                    <th>[${categoryNames[cat]}]</th>
                    <td>
                        <strong>${vendor.name}</strong><br>
                        <span style="color:#666; font-size:0.9em;">[ìƒí’ˆ] ${product.name}</span><br>
                        <span style="color:#888; font-size:0.85em;">[êµ¬ì„±] ${vendor.desc}</span>
                    </td>
                </tr>
            `;
        }
    }

    if (selectedCount < 2) {
        alert("ê²¬ì ì€ ìµœì†Œ 2ê°œ ì´ìƒì˜ ì—…ì²´ë¥¼ ì„ íƒí•´ì•¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        return;
    }

    // ê°€ê²© ì •ì±…: ì„ íƒí•œ ì—…ì²´ ê°œìˆ˜ë§Œí¼ x 10ë§Œì› ì¶”ê°€
    let addPrice = 100000 * selectedCount;
    let finalCost = totalCost + addPrice;

    document.getElementById('selection-view').style.display = 'none';
    document.getElementById('result-view').style.display = 'block';
    document.getElementById('res-naver-id').innerText = naverId;
    document.getElementById('quote-result-body').innerHTML = html;
    document.getElementById('total-amount').innerText = finalCost.toLocaleString();
    window.scrollTo(0, 0);
}

// 3. ê´€ë¦¬ì ëª¨ë“œ ê¸°ëŠ¥

function enterAdminMode() {
    const pwd = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
    if (pwd === "wjdrhkr1004#") {
        document.getElementById('admin-modal').style.display = 'block';
        resetAdminForm();
    } else if(pwd !== null) {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    }
}

function closeAdminMode() {
    document.getElementById('admin-modal').style.display = 'none';
    location.reload(); 
}

function resetAdminForm() {
    cancelEdit();
    renderAdminList();
    document.getElementById('product-list-container').innerHTML = '';
    addProductRow();
}

function addProductRow(name = '', price = '') {
    const container = document.getElementById('product-list-container');
    const div = document.createElement('div');
    div.className = 'product-row';
    div.innerHTML = `
        <input type="text" class="prod-name" placeholder="ìƒí’ˆëª…" value="${name}">
        <input type="number" class="prod-price" placeholder="ê°€ê²©" value="${price}">
        <button type="button" class="btn-remove-prod" onclick="this.parentElement.remove()">-</button>
    `;
    container.appendChild(div);
}

function renderAdminList() {
    const cat = document.getElementById('admin-category-select').value;
    const listArea = document.getElementById('admin-vendor-list');
    listArea.innerHTML = '';

    vendorData[cat].forEach((v, idx) => {
        const li = document.createElement('li');
        li.style.marginBottom = '15px';
        
        let prodText = v.products.map(p => `${p.name}(${p.price.toLocaleString()}ì›)`).join(', ');

        li.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <strong>${v.name}</strong>
                <div>
                    <button class="btn-edit" onclick="editVendor('${cat}', ${idx})">ìˆ˜ì •</button>
                    <button class="btn-del" onclick="deleteVendor('${cat}', ${idx})">ì‚­ì œ</button>
                </div>
            </div>
            <div style="font-size:0.85em; color:#555; margin-top:5px;">
                <strong>êµ¬ì„±:</strong> ${v.desc} <br>
                <strong>ìƒí’ˆ:</strong> ${prodText}
            </div>
        `;
        listArea.appendChild(li);
    });
}

function editVendor(cat, idx) {
    currentEditIndex = idx;
    const v = vendorData[cat][idx];
    
    document.getElementById('new-vendor-name').value = v.name;
    document.getElementById('new-vendor-desc').value = v.desc;
    
    const container = document.getElementById('product-list-container');
    container.innerHTML = '';
    if (v.products && v.products.length > 0) {
        v.products.forEach(p => addProductRow(p.name, p.price));
    } else {
        addProductRow();
    }

    document.getElementById('btn-save-vendor').innerText = "ìˆ˜ì • ì™„ë£Œ";
    document.getElementById('btn-cancel-edit').style.display = "inline-block";
    document.querySelector('.admin-content').scrollTop = 0;
}

function cancelEdit() {
    currentEditIndex = -1;
    document.getElementById('btn-save-vendor').innerText = "ì—…ì²´ ì €ì¥/ì¶”ê°€";
    document.getElementById('btn-cancel-edit').style.display = "none";
    
    document.getElementById('new-vendor-name').value = '';
    document.getElementById('new-vendor-desc').value = '';
    document.getElementById('product-list-container').innerHTML = '';
    addProductRow();
}

function saveVendor() {
    const cat = document.getElementById('admin-category-select').value;
    const name = document.getElementById('new-vendor-name').value;
    const desc = document.getElementById('new-vendor-desc').value;
    
    if (!name) { alert("ì—…ì²´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"); return; }

    const prodRows = document.querySelectorAll('.product-row');
    let products = [];
    let valid = true;

    prodRows.forEach(row => {
        const pName = row.querySelector('.prod-name').value.trim();
        const pPrice = row.querySelector('.prod-price').value;

        if (pName && pPrice) {
            products.push({ name: pName, price: parseInt(pPrice) });
        } else if (pName || pPrice) {
            valid = false;
        }
    });

    if (!valid || products.length === 0) {
        alert("ì ì–´ë„ í•˜ë‚˜ì˜ ì™„ì „í•œ ìƒí’ˆ ì •ë³´(ì´ë¦„+ê°€ê²©)ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
        return;
    }

    const newVendorObj = {
        id: currentEditIndex === -1 ? Date.now() : vendorData[cat][currentEditIndex].id,
        name: name,
        desc: desc,
        products: products
    };

    if (currentEditIndex === -1) {
        vendorData[cat].push(newVendorObj);
        alert("ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
    } else {
        vendorData[cat][currentEditIndex] = newVendorObj;
        alert("ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    localStorage.setItem('halfwed_data_v2', JSON.stringify(vendorData));
    resetAdminForm();
}

function deleteVendor(cat, idx) {
    if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        vendorData[cat].splice(idx, 1);
        localStorage.setItem('halfwed_data_v2', JSON.stringify(vendorData));
        resetAdminForm();
    }
}
</script>

</body>
</html>